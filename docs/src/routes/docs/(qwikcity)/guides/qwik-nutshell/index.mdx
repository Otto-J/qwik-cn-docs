---
title: Qwikç®€ä»‹
description: åœ¨è¿™ä¸ªç®€çŸ­çš„ä»‹ç»æŒ‡å—ä¸­äº†è§£Qwikçš„ä¸€èˆ¬æ¦‚å¿µã€‚
contributors:
  - manucorporat
  - AnthonyPAlicea
  - the-r3aper7
  - hamatoyogi
---
# Qwikç®€ä»‹

## ç»„ä»¶

Qwikç»„ä»¶ä¸Reactç»„ä»¶éå¸¸ç›¸ä¼¼ã€‚å®ƒä»¬æ˜¯è¿”å›JSXçš„å‡½æ•°ã€‚ç„¶è€Œï¼Œéœ€è¦ä½¿ç”¨`component$(...)`ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºå¿…é¡»å…·æœ‰`$`åç¼€ï¼Œä½¿ç”¨`useSignal()`åˆ›å»ºçŠ¶æ€ï¼Œä½¿ç”¨`class`ä»£æ›¿`className`ç­‰ç­‰ã€‚

- ç»„ä»¶æ€»æ˜¯ä½¿ç”¨`component$`å‡½æ•°å£°æ˜ã€‚
- ç»„ä»¶å¯ä»¥ä½¿ç”¨`useSignal`é’©å­åˆ›å»ºå“åº”å¼çŠ¶æ€ã€‚
- äº‹ä»¶å¤„ç†ç¨‹åºä½¿ç”¨`$`åç¼€å£°æ˜ã€‚
- å¯¹äº`<input>`ï¼Œåœ¨Qwikä¸­ï¼Œ`onChange`äº‹ä»¶ç§°ä¸º`onInput$`ã€‚
- JSXæ›´å–œæ¬¢HTMLå±æ€§ã€‚`class`ä»£æ›¿`className`ã€‚`for`ä»£æ›¿`htmlFor`ã€‚
- æ¡ä»¶æ¸²æŸ“ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦`?`å’Œ`&&`è¿ç®—ç¬¦ï¼Œä¸Reactç±»ä¼¼ã€‚


```tsx title="src/components/my-other-component/index.tsx"
import { component$, Slot } from '@builder.io/qwik';
import type { ClassList } from '@builder.io/qwik'

export component$((props: { class?: ClassList }) => { // âœ…
  return <div class={class}><Slot /></div>;
});
```

```tsx
import { component$, useSignal } from '@builder.io/qwik';

// å…¶ä»–ç»„ä»¶å¯ä»¥å¯¼å…¥å¹¶åœ¨JSXä¸­ä½¿ç”¨ã€‚
import { MyOtherComponent } from './my-other-component';

interface MyComponentProps {
  step: number;
}

// ç»„ä»¶æ€»æ˜¯ä½¿ç”¨`component$`å‡½æ•°å£°æ˜ã€‚
export const MyComponent = component$((props: MyComponentProps) => {
  // ç»„ä»¶ä½¿ç”¨`useSignal`é’©å­åˆ›å»ºå“åº”å¼çŠ¶æ€ã€‚
  const count = useSignal(0); // { value: 0 }
  return (
    <>
      <button
        onClick$={() => {
          // äº‹ä»¶å¤„ç†ç¨‹åºå…·æœ‰`$`åç¼€ã€‚
          count.value = count.value + props.step;
        }}
      >
        Increment by {props.step}
      </button>
      <main
        class={{
          even: count.value % 2 === 0,
          odd: count.value % 2 === 1,
        }}
      >
        <h1>Count: {count.value}</h1>
        <MyOtherComponent class="correct-way" /> {/* âœ… */}
          {count.value > 10 && <p>Count is greater than 10</p>}
          {count.value > 10 ? <p>Count is greater than 10</p> : <p>Count is less than 10</p>}
        </MyOtherComponent>
      </main>
    </>
  );
});
```

### æ¸²æŸ“é¡¹ç›®åˆ—è¡¨

ä¸Reactä¸€æ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`map`å‡½æ•°æ¸²æŸ“é¡¹ç›®åˆ—è¡¨ï¼Œä½†æ˜¯åˆ—è¡¨ä¸­çš„æ¯ä¸ªé¡¹ç›®å¿…é¡»å…·æœ‰å”¯ä¸€çš„`key`å±æ€§ã€‚`key`å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œå¹¶ä¸”åœ¨åˆ—è¡¨ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚

```tsx
import { component$, useSignal } from '@builder.io/qwik';
import { US_PRESIDENTS } from './presidents';

export const PresidentsList = component$(() => {
  return (
    <ul>
      {US_PRESIDENTS.map((president) => (
        <li key={president.number}>
          <h2>{president.name}</h2>
          <p>{president.description}</p>
        </li>
      ))}
    </ul>
  );
});
```

### é‡ç”¨äº‹ä»¶å¤„ç†ç¨‹åº

å¯ä»¥åœ¨JSXèŠ‚ç‚¹ä¹‹é—´é‡ç”¨äº‹ä»¶å¤„ç†ç¨‹åºã€‚é€šè¿‡ä½¿ç”¨`$(...handler...)`åˆ›å»ºå¤„ç†ç¨‹åºã€‚

```tsx
import { $, component$, useSignal } from '@builder.io/qwik';

interface MyComponentProps {
  step: number;
}

// ç»„ä»¶æ€»æ˜¯ä½¿ç”¨`component$`å‡½æ•°å£°æ˜ã€‚
export const MyComponent = component$(() => {
  const count = useSignal(0);

  // æ³¨æ„äº‹ä»¶å¤„ç†ç¨‹åºå‡½æ•°å‘¨å›´çš„`$(...)`ã€‚
  const inputHandler = $((event) => {
    console.log('input', event.target.name, event.target.value);
  });

  return (
    <>
      <input name="name" onInput$={inputHandler} />
      <input
        name="password"
        onInput$={inputHandler}
      />
    </>
  );
});
```

### å†…å®¹æŠ•å½±

å†…å®¹æŠ•å½±é€šè¿‡`<Slot/>`ç»„ä»¶å®Œæˆï¼Œè¯¥ç»„ä»¶ä»`@builder.io/qwik`å¯¼å‡ºã€‚æ’æ§½å¯ä»¥å‘½åï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨`q:slot`å±æ€§è¿›è¡ŒæŠ•å½±ã€‚

```tsx
// æ–‡ä»¶: src/components/Button/Button.tsx
import { component$, Slot } from '@builder.io/qwik';
import styles from './Button.module.css';

export const Button = component$(() => {
  return (
    <button class={styles.button}>
      <div class={styles.start}>
        <Slot name="start" />
      </div>
      <Slot />
      <div class={styles.end}>
        <Slot name="end" />
      </div>
    </button>
  );
});

export default component$(() => {
  return (
    <Button>
      <span q:slot="start">ğŸ“©</span>
      Hello world
      <span q:slot="end">ğŸŸ©</span>
    </Button>
  );
});
```

### ä½¿ç”¨é’©å­çš„è§„åˆ™

ä»¥`use`å¼€å¤´çš„æ–¹æ³•åœ¨Qwikä¸­æ˜¯ç‰¹æ®Šçš„ï¼Œä¾‹å¦‚`useSignal()`ã€`useStore()`ã€`useOn()`ã€`useTask$()`ã€`useLocation()`ç­‰ã€‚ä¸Reacté’©å­éå¸¸ç›¸ä¼¼ã€‚

- å®ƒä»¬åªèƒ½åœ¨`component$`å†…éƒ¨è°ƒç”¨ã€‚
- å®ƒä»¬åªèƒ½åœ¨`component$`çš„é¡¶å±‚è°ƒç”¨ï¼Œä¸èƒ½åœ¨æ¡ä»¶æˆ–å¾ªç¯å†…éƒ¨è°ƒç”¨ã€‚

## æ ·å¼

Qwikæ”¯æŒå¼€ç®±å³ç”¨çš„CSSæ¨¡å—ï¼Œç”šè‡³æ”¯æŒTailwindã€å…¨å±€CSSå¯¼å…¥å’Œä½¿ç”¨`useStylesScoped$()`è¿›è¡Œå»¶è¿ŸåŠ è½½çš„ä½œç”¨åŸŸCSSã€‚CSSæ¨¡å—æ˜¯æ ·å¼åŒ–Qwikç»„ä»¶çš„æ¨èæ–¹å¼ã€‚

### CSSæ¨¡å—

è¦ä½¿ç”¨CSSæ¨¡å—ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ª`.module.css`æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ`src/components/MyComponent/MyComponent.module.css`ã€‚

```css title="src/components/MyComponent/MyComponent.module.css"
.container {
  background-color: red;
}
```

ç„¶åï¼Œåœ¨ç»„ä»¶ä¸­å¯¼å…¥CSSæ¨¡å—ã€‚

```tsx title="src/components/MyComponent/MyComponent.tsx"
import { component$ } from '@builder.io/qwik';
import styles from './MyComponent.module.css';

export default component$(() => {
  return <div class={styles.container}>Hello world</div>;
});
```

è¯·è®°ä½ï¼ŒQwikä½¿ç”¨`class`è€Œä¸æ˜¯`className`æ¥è¡¨ç¤ºCSSç±»ã€‚

## $(...)è§„åˆ™

ä»¥`$`ç»“å°¾çš„`$(...)`å‡½æ•°å’Œä»»ä½•ä»¥`$`ç»“å°¾çš„å‡½æ•°åœ¨Qwikä¸­æ˜¯ç‰¹æ®Šçš„ï¼Œä¾‹å¦‚ï¼š`$()`ã€`useTask$()`ã€`useVisibleTask$()`...ç»“å°¾çš„`$`è¡¨ç¤ºå»¶è¿ŸåŠ è½½è¾¹ç•Œã€‚é€‚ç”¨äºä»»ä½•`$`å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ä¸€äº›è§„åˆ™ã€‚å®ƒä¸jQueryæ— å…³ã€‚

- ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå·²å¯¼å…¥çš„å˜é‡ã€‚
- ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯åŒä¸€æ¨¡å—é¡¶å±‚å£°æ˜çš„å˜é‡ã€‚
- ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯è¡¨è¾¾å¼ä¸­çš„ä»»ä½•å˜é‡ã€‚
- å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°ï¼Œåˆ™å®ƒåªèƒ½æ•è·åœ¨åŒä¸€æ¨¡å—çš„é¡¶å±‚å£°æ˜çš„å˜é‡æˆ–å…¶å€¼å¯åºåˆ—åŒ–çš„å˜é‡ã€‚å¯åºåˆ—åŒ–çš„å€¼åŒ…æ‹¬ï¼š`string`ã€`number`ã€`boolean`ã€`null`ã€`undefined`ã€`Array`ã€`Object`ã€`Date`ã€`RegExp`ã€`Map`ã€`Set`ã€`BigInt`ã€`Promise`ã€`Error`ã€`JSXèŠ‚ç‚¹`ã€`Signal`ã€`Store`ç”šè‡³HTMLElementsã€‚

```tsx
// `$`å‡½æ•°çš„æœ‰æ•ˆç¤ºä¾‹ã€‚
import { $, component$, useSignal } from '@builder.io/qwik';
import { importedFunction } from './my-other-module';

export function exportedFunction() {
  console.log('exported function');
}

export default component$(() => {
  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚
  const valid1 = $((event) => {
    console.log('input', event.target.name, event.target.value);
  });

  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¼å…¥çš„æ ‡è¯†ç¬¦ã€‚
  const valid2 = $(importedFunction);

  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åŒä¸€æ¨¡å—é¡¶å±‚å£°æ˜çš„æ ‡è¯†ç¬¦ã€‚
  const valid3 = $(exportedFunction);

  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ²¡æœ‰å±€éƒ¨å˜é‡çš„è¡¨è¾¾å¼ã€‚
  const valid4 = $([1, 2, { a: 'hello' }]);

  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•è·å±€éƒ¨å˜é‡çš„å‡½æ•°ã€‚
  const localVariable = 1;
  const valid5 = $((event) => {
    console.log('local variable', localVariable);
  });
});
```

ä»¥ä¸‹æ˜¯ä¸€äº›æ— æ•ˆ`$`å‡½æ•°çš„ç¤ºä¾‹ã€‚

```tsx
// `$`å‡½æ•°çš„æ— æ•ˆç¤ºä¾‹ã€‚
import { $, component$, useSignal } from '@builder.io/qwik';
import { importedVariable } from './my-other-module';

export default component$(() => {
  const unserializable = new CustomClass();
  const localVariable = 1;

  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ã€‚
  const invalid1 = $(localVariable);

  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•è·ä¸å¯åºåˆ—åŒ–å±€éƒ¨å˜é‡çš„å‡½æ•°ã€‚
  const invalid2 = $((event) => {
    console.log('custom class', unserializable);
  });

  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½¿ç”¨å±€éƒ¨å˜é‡çš„è¡¨è¾¾å¼ã€‚
  const invalid3 = $(localVariable + 1);

  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½¿ç”¨å¯¼å…¥å˜é‡çš„è¡¨è¾¾å¼ã€‚
  const invalid4 = $(importedVariable + 'hello');
});
```

## å“åº”å¼çŠ¶æ€

### `useSignal(initialValue?)`

`useSignal()`æ˜¯åˆ›å»ºå“åº”å¼çŠ¶æ€çš„ä¸»è¦æ–¹æ³•ã€‚ä¿¡å·å¯ä»¥åœ¨ç»„ä»¶ä¹‹é—´å…±äº«ï¼Œå¹¶ä¸”è¯»å–ä¿¡å·çš„æ¯ä¸ªç»„ä»¶ã€ä»»åŠ¡å°†åœ¨ä¿¡å·æ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ã€‚

```ts
// `Signal<T>`å’Œ`useSignal<T>`çš„TypeScriptå®šä¹‰

export interface Signal<T> {
  value: T;
}

export const useSignal: <T>(value?: T | (() => T)): Signal<T>;
```

`useSignal(initialValue?)`æ¥å—ä¸€ä¸ªå¯é€‰çš„åˆå§‹å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ª`Signal<T>`å¯¹è±¡ã€‚`Signal<T>`å¯¹è±¡å…·æœ‰ä¸€ä¸ª`value`å±æ€§ï¼Œå¯ä»¥è¯»å–å’Œå†™å…¥è¯¥å±æ€§ã€‚å½“ç»„ä»¶æˆ–ä»»åŠ¡è®¿é—®`value`å±æ€§æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè®¢é˜…ï¼Œå› æ­¤å½“`value`æ›´æ”¹æ—¶ï¼Œè¯»å–`value`çš„æ¯ä¸ªç»„ä»¶ã€ä»»åŠ¡æˆ–å¦ä¸€ä¸ªè®¡ç®—ä¿¡å·éƒ½å°†é‡æ–°è®¡ç®—ã€‚

### `useStore(initialValue?)`

`useStore(initialValue?)`ä¸`useSignal`ç±»ä¼¼ï¼Œä½†å®ƒåˆ›å»ºä¸€ä¸ªå“åº”å¼çš„JavaScriptå¯¹è±¡ï¼Œä½¿å¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½å…·æœ‰å“åº”æ€§ï¼Œå°±åƒä¿¡å·çš„`value`ä¸€æ ·ã€‚åœ¨å†…éƒ¨ï¼Œ`useStore`ä½¿ç”¨æ‹¦æˆªæ‰€æœ‰å±æ€§è®¿é—®çš„`Proxy`å¯¹è±¡æ¥ä½¿å±æ€§å…·æœ‰å“åº”æ€§ã€‚

```ts
// `useStore<T>`çš„TypeScriptå®šä¹‰

// `Reactive<T>`æ˜¯`T`ç±»å‹çš„å“åº”å¼ç‰ˆæœ¬ï¼Œ`T`çš„æ¯ä¸ªå±æ€§çš„è¡Œä¸ºéƒ½åƒ`Signal<T>`ä¸€æ ·ã€‚
export interface Reactive<T extends Record<string, any>> extends T {}

export interface StoreOptions {
  // å¦‚æœ`deep`ä¸ºtrueï¼Œåˆ™å­˜å‚¨çš„åµŒå¥—å±æ€§å°†åŒ…è£…åœ¨`Signal<T>`ä¸­ã€‚
  deep?: boolean;
}
export const useStore: <T>(value?: T | (() => T), options?: StoreOptions): Reactive<T>;
```

åœ¨å®è·µä¸­ï¼Œ`useSignal`å’Œ`useStore`éå¸¸ç›¸ä¼¼--`useSignal(0) === useStore({ value: 0 })`--ä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ`useSignal`æ›´å¯å–ã€‚`useStore`çš„ä¸€äº›ç”¨ä¾‹åŒ…æ‹¬ï¼š

- å½“éœ€è¦åœ¨æ•°ç»„ä¸­ä½¿ç”¨å“åº”æ€§æ—¶ã€‚
- å½“æ‚¨æƒ³è¦ä¸€ä¸ªå¯ä»¥è½»æ¾æ·»åŠ å±æ€§çš„å“åº”å¼å¯¹è±¡ã€‚

```tsx
import { component$, useStore } from '@builder.io/qwik';

export const Counter = component$(() => {
  // ä½¿ç”¨`useStore`é’©å­åˆ›å»ºå“åº”å¼å­˜å‚¨ã€‚
  const todoList = useStore(
    {
      array: [],
    },
    { deep: true }
  );

  // todoList.arrayæ˜¯ä¸€ä¸ªå“åº”å¼æ•°ç»„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶æ¨å…¥å…¶ä¸­ï¼Œå¹¶ä¸”ç»„ä»¶å°†é‡æ–°æ¸²æŸ“ã€‚

  return (
    <>
      <h1>Todo List</h1>
      <ul>
        {todoList.array.map((todo) => (
          <li key={todo.id}>
            <input
              type="checkbox"
              checked={todo.completed}
              onInput$={() => {
                // todoListæ˜¯ä¸€ä¸ªå“åº”å¼å­˜å‚¨
                // å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†`deep: true`ï¼Œæ‰€ä»¥`todo`å¯¹è±¡ä¹Ÿæ˜¯å“åº”å¼çš„ã€‚
                // å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹`completed`å±æ€§ï¼Œç»„ä»¶å°†é‡æ–°æ¸²æŸ“ã€‚
                todo.completed = !todo.completed;
              }}
            />
            {todo.text}
          </li>
        ))}
      </ul>
    </>
  );
});
```

### `useTask$(() => { ... })`

`useTask$`ç”¨äºåˆ›å»ºå¼‚æ­¥ä»»åŠ¡ã€‚ä»»åŠ¡ç”¨äºå®ç°å‰¯ä½œç”¨ã€è¿è¡Œé‡å‹è®¡ç®—å’Œå¼‚æ­¥ä»£ç ä½œä¸ºæ¸²æŸ“ç”Ÿå‘½å‘¨æœŸçš„ä¸€éƒ¨åˆ†ã€‚`useTask$`ä»»åŠ¡åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹å‰æ‰§è¡Œï¼Œå¹¶åœ¨è·Ÿè¸ªçš„ä¿¡å·æˆ–å­˜å‚¨æ›´æ”¹æ—¶é‡æ–°æ‰§è¡Œã€‚

```tsx
import { component$, useSignal, useTask$ } from '@builder.io/qwik';

export const Counter = component$(() => {
  const page = useSignal(0);
  const listOfUsers = useSignal([]);

  // ä½¿ç”¨`useTask$`é’©å­åˆ›å»ºä»»åŠ¡ã€‚
  useTask$(() => {
    // ä»»åŠ¡åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹å‰æ‰§è¡Œã€‚
    console.log('Task executed before first render');
  });

  // æ‚¨å¯ä»¥åˆ›å»ºå¤šä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚
  useTask$(async (taskContext) => {
    // ç”±äºæˆ‘ä»¬å¸Œæœ›åœ¨`page`æ›´æ”¹æ—¶é‡æ–°è¿è¡Œä»»åŠ¡ï¼Œ
    // æˆ‘ä»¬éœ€è¦è·Ÿè¸ªå®ƒã€‚
    taskContext.track(() => page.value);
    console.log('Task executed before the first render AND when page changes');
    console.log('Current page:', page.value);

    // ä»»åŠ¡å¯ä»¥è¿è¡Œå¼‚æ­¥ä»£ç ï¼Œä¾‹å¦‚è·å–æ•°æ®ã€‚
    const res = await fetch(`https://api.randomuser.me/?page=${page.value}`);
    const json = await res.json();

    // å°†å€¼åˆ†é…ç»™ä¿¡å·å°†è§¦å‘é‡æ–°æ¸²æŸ“ã€‚
    listOfUsers.value = json.results;
  });

  return (
    <>
      <h1>Page {page.value}</h1>
      <ul>
        {listOfUsers.value.map((user) => (
          <li key={user.login.uuid}>
            {user.name.first} {user.name.last}
          </li>
        ))}
      </ul>
      <button onClick$={() => page.value++}>Next Page</button>
    </>
  );
});
```

`useTask$()`å°†åœ¨SSRæœŸé—´åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œåœ¨å®¢æˆ·ç«¯ä¸Šé¦–æ¬¡æŒ‚è½½ç»„ä»¶æ—¶åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œã€‚å› æ­¤ï¼Œåœ¨ä»»åŠ¡ä¸­è®¿é—®DOM APIä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå®ƒä»¬åœ¨æœåŠ¡å™¨ä¸Šä¸å¯ç”¨ã€‚ç›¸åï¼Œæ‚¨åº”è¯¥ä½¿ç”¨äº‹ä»¶å¤„ç†ç¨‹åºæˆ–`useVisibleTask$()`åœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œä»»åŠ¡ã€‚

### `useVisibleTask$(() => { ... })`

`useVisibleTask$`ç”¨äºåˆ›å»ºä»…åœ¨ç»„ä»¶é¦–æ¬¡æŒ‚è½½åˆ°DOMåç«‹å³è¿è¡Œçš„ä»»åŠ¡ã€‚å®ƒç±»ä¼¼äº`useTask$`ï¼Œä½†ä»…åœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œï¼Œå¹¶åœ¨é¦–æ¬¡æ¸²æŸ“åæ‰§è¡Œã€‚å› ä¸ºå®ƒåœ¨æ¸²æŸ“åæ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥æ£€æŸ¥DOMæˆ–ä½¿ç”¨æµè§ˆå™¨APIã€‚

```tsx
import { component$, useSignal, useVisibleTask$ } from '@builder.io/qwik';

export const Clock = component$(() => {
  const time = useSignal(0);

  // ä½¿ç”¨`useVisibleTask$`é’©å­åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œå®ƒåœ¨å®¢æˆ·ç«¯ä¸Šæ€¥åˆ‡åœ°è¿è¡Œã€‚
  useVisibleTask$((taskContext) => {
    // ç”±äºæ­¤VisibleTaskæ²¡æœ‰è·Ÿè¸ªä»»ä½•ä¿¡å·ï¼Œå®ƒåªä¼šè¿è¡Œä¸€æ¬¡ã€‚

    const interval = setInterval(() => {
      time.value = new Date();
    }, 1000);

    // å½“ç»„ä»¶å¸è½½æˆ–ä»»åŠ¡é‡æ–°è¿è¡Œæ—¶ï¼Œå°†è°ƒç”¨`cleanup`å‡½æ•°ã€‚
    taskContext.cleanup(() => clearInterval(interval));
  });

  return (
    <>
      <h1>Clock</h1>
      <h1>Seconds passed: {time.value}</h1>
    </>
  );
});
```

ç”±äºQwikåœ¨ç”¨æˆ·äº¤äº’ä¹‹å‰ä¸æ‰§è¡Œä»»ä½•æµè§ˆå™¨ä¸Šçš„Javascriptä»£ç ï¼Œ`useVisibleTask$()`æ˜¯å”¯ä¸€åœ¨å®¢æˆ·ç«¯ä¸Šæ€¥åˆ‡è¿è¡Œçš„APIï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒæ˜¯æ‰§è¡Œä»¥ä¸‹æ“ä½œçš„å¥½åœ°æ–¹ï¼š

- è®¿é—®DOM API
- åˆå§‹åŒ–ä»…åœ¨æµè§ˆå™¨ä¸­çš„åº“
- è¿è¡Œåˆ†æä»£ç 
- å¯åŠ¨åŠ¨ç”»æˆ–è®¡æ—¶å™¨ã€‚

è¯·æ³¨æ„ï¼Œä¸åº”è¯¥ä½¿ç”¨`useVisibleTask$()`æ¥è·å–æ•°æ®ï¼Œå› ä¸ºå®ƒä¸ä¼šåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚ç›¸åï¼Œæ‚¨åº”è¯¥ä½¿ç”¨`useTask$()`æ¥è·å–æ•°æ®ï¼Œç„¶åä½¿ç”¨`useVisibleTask$()`æ‰§è¡Œè¯¸å¦‚å¯åŠ¨åŠ¨ç”»ä¹‹ç±»çš„æ“ä½œã€‚æ»¥ç”¨`useVisibleTask$()`å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

## è·¯ç”±

Qwikæä¾›äº†åŸºäºæ–‡ä»¶çš„è·¯ç”±å™¨ï¼Œç±»ä¼¼äºNext.jsï¼Œä½†æœ‰ä¸€äº›åŒºåˆ«ã€‚è·¯ç”±å™¨åŸºäºæ–‡ä»¶ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯`src/routes/`ã€‚åœ¨`src/routes/`ä¸‹çš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„`index.tsx`æ–‡ä»¶å°†åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯ç”±ã€‚ä¾‹å¦‚ï¼Œ`src/routes/home/index.tsx`å°†åˆ›å»ºä¸€ä¸ªä½äº`/home/`çš„è·¯ç”±ã€‚

```tsx title="src/routes/home/index.tsx"

import { component$ } from '@builder.io/qwik';

export default component$(() => {
  return <h1>Home</h1>;
});
```

éå¸¸é‡è¦çš„æ˜¯å°†ç»„ä»¶ä½œä¸ºé»˜è®¤å¯¼å‡ºè¿›è¡Œå¯¼å‡ºï¼Œå¦åˆ™è·¯ç”±å™¨å°†æ— æ³•æ‰¾åˆ°å®ƒã€‚

### è·¯ç”±å‚æ•°

æ‚¨å¯ä»¥é€šè¿‡åœ¨è·¯ç”±è·¯å¾„ä¸­æ·»åŠ åŒ…å«`[param]`çš„æ–‡ä»¶å¤¹æ¥åˆ›å»ºåŠ¨æ€è·¯ç”±ã€‚ä¾‹å¦‚ï¼Œ`src/routes/user/[id]/index.tsx`å°†åˆ›å»ºä¸€ä¸ªä½äº`/user/:id/`çš„è·¯ç”±ã€‚ä¸ºäº†è®¿é—®è·¯ç”±å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä»`@builder.io/qwik-city`å¯¼å‡ºçš„`useLocation`é’©å­ã€‚

```tsx title="src/routes/user/[userID]/index.tsx"

import { component$ } from '@builder.io/qwik';
import { useLocation } from '@builder.io/qwik-city';

export default component$(() => {
  const loc = useLocation();
  return (
    <main>
      {loc.isNavigating && <p>Loading...</p>}
      <h1>User: {loc.params.userID}</h1>
      <p>Current URL: {loc.url.href}</p>
    </main>
  );
});
```

`useLocation()`è¿”å›ä¸€ä¸ªå“åº”å¼çš„`RouteLocation`å¯¹è±¡ï¼Œè¿™æ„å‘³ç€å½“è·¯ç”±æ›´æ”¹æ—¶ï¼Œå®ƒå°†é‡æ–°æ¸²æŸ“ã€‚`RouteLocation`å¯¹è±¡å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š

```tsx
/**
 * `useLocation()`è¿”å›çš„å½“å‰è·¯ç”±ä½ç½®ã€‚
 */
export interface RouteLocation {
  readonly params: Readonly<Record<string, string>>;
  readonly url: URL;
  readonly isNavigating: boolean;
}
```

### é“¾æ¥åˆ°å…¶ä»–è·¯ç”±

è¦é“¾æ¥åˆ°å…¶ä»–è·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨ä»`@builder.io/qwik-city`å¯¼å‡ºçš„`Link`ç»„ä»¶ã€‚`Link`ç»„ä»¶æ¥å—æ‰€æœ‰`<a>` HTMLAnchorElementçš„å±æ€§ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯å®ƒå°†ä½¿ç”¨Qwikè·¯ç”±å™¨è¿›è¡ŒSPAå¯¼èˆªåˆ°è·¯ç”±ï¼Œè€Œä¸æ˜¯è¿›è¡Œå®Œæ•´çš„é¡µé¢å¯¼èˆªã€‚

```tsx title="src/routes/index.tsx"

import { component$ } from '@builder.io/qwik';
import { Link } from '@builder.io/qwik-city';

export default component$(() => {
  return (
    <>
      <h1>Home</h1>
      <Link href="/about/">SPA navigate to /about/</Link>
      <a href="/about/">Full page navigate to /about/</a>
    </>
  );
});
```

## è·å–/åŠ è½½æ•°æ®

ä»æœåŠ¡å™¨åŠ è½½æ•°æ®çš„æ¨èæ–¹å¼æ˜¯ä½¿ç”¨ä»`@builder.io/qwik-city`å¯¼å‡ºçš„`routeLoader$()`å‡½æ•°ã€‚`routeLoader$()`å‡½æ•°ç”¨äºåˆ›å»ºåœ¨è·¯ç”±æ¸²æŸ“ä¹‹å‰åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„æ•°æ®åŠ è½½ç¨‹åºã€‚`routeLoader$()`çš„è¿”å›å€¼å¿…é¡»ä½œä¸ºå‘½åå¯¼å‡ºä»è·¯ç”±æ–‡ä»¶ä¸­å¯¼å‡ºï¼Œå³åªèƒ½åœ¨`index.tsx`ä¸­ä½¿ç”¨ï¼Œä½äº`src/routes/`å†…ã€‚

```tsx title="src/routes/user/[userID]/index.tsx"

import { component$ } from '@builder.io/qwik';
import { routeLoader$ } from '@builder.io/qwik-city';

// `routeLoader$()`å‡½æ•°ç”¨äºåˆ›å»ºåœ¨è·¯ç”±æ¸²æŸ“ä¹‹å‰åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„æ•°æ®åŠ è½½ç¨‹åºã€‚
// `routeLoader$()`çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„useé’©å­ï¼Œå¯ä»¥ç”¨äºè®¿é—®ä»`routeLoader$()`è¿”å›çš„æ•°æ®ã€‚
export const useUserData = routeLoader$(async (requestContext) => {
  const user = await db.table('users').get(requestContext.params.userID);
  return {
    name: user.name,
    email: user.email,
  };
});

export default component$(() => {
  // `useUserData`é’©å­å°†è¿”å›ä¸€ä¸ªåŒ…å«ä»`routeLoader$()`è¿”å›çš„æ•°æ®çš„`Signal`ï¼Œå½“å¯¼èˆªæ›´æ”¹å¹¶ä¸”é‡æ–°è¿è¡Œ`routeLoader$()`æ—¶ï¼Œå®ƒå°†é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚
  const userData = useUserData();
  return (
    <main>
      <h1>User data</h1>
      <p>User name: {userData.value.name}</p>
      <p>User email: {userData.value.email}</p>
    </main>
  );
});

// å¯¼å‡ºçš„`head`å‡½æ•°ç”¨äºè®¾ç½®è·¯ç”±çš„æ–‡æ¡£å¤´ã€‚
export const head: DocumentHead = ({resolveValue}) => {
  // å®ƒå¯ä»¥ä½¿ç”¨`resolveValue()`æ–¹æ³•ä»`routeLoader$()`è§£æå€¼ã€‚
  const user = resolveValue(useUserData);
  return {
    title: `User: "${user.name}"`,
    meta: [
      {
        name: 'description',
        content: 'User page',
      },
    ],
  };
};
```

`routeLoader$()`å‡½æ•°æ¥å—ä¸€ä¸ªè¿”å›Promiseçš„å‡½æ•°ã€‚è¯¥Promiseåœ¨æœåŠ¡å™¨ä¸Šè§£æï¼Œè§£æåçš„å€¼ä¼ é€’ç»™`useCustomLoader$()`é’©å­ã€‚`useCustomLoader$()`é’©å­æ˜¯ç”±`routeLoader$()`å‡½æ•°åˆ›å»ºçš„è‡ªå®šä¹‰é’©å­ã€‚`useCustomLoader$()`é’©å­è¿”å›ä¸€ä¸ªåŒ…å«ä»`routeLoader$()`å‡½æ•°è¿”å›çš„Promiseçš„`Signal`ã€‚`useCustomLoader$()`é’©å­å°†åœ¨è·¯ç”±æ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œå¹¶åœ¨é‡æ–°è¿è¡Œ`routeLoader$()`å‡½æ•°æ—¶é‡æ–°è¿è¡Œã€‚

## å¤„ç†è¡¨å•æäº¤

Qwikæä¾›äº†ä»`@builder.io/qwik-city`å¯¼å‡ºçš„`routeAction$()` APIæ¥å¤„ç†æœåŠ¡å™¨ä¸Šçš„è¡¨å•è¯·æ±‚ã€‚`routeAction$()`ä»…åœ¨è¡¨å•æäº¤æ—¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚

```tsx title="src/routes/user/[userID]/index.tsx"

import { component$ } from '@builder.io/qwik';
import { routeAction$, Form, zod$, z } from '@builder.io/qwik-city';

// `routeAction$()`å‡½æ•°ç”¨äºåˆ›å»ºåœ¨è¡¨å•æäº¤æ—¶åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„æ•°æ®åŠ è½½ç¨‹åºã€‚
// `routeAction$()`çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„useé’©å­ï¼Œå¯ä»¥ç”¨äºè®¿é—®ä»`routeAction$()`è¿”å›çš„æ•°æ®ã€‚
export const useUserUpdate = routeAction$(async (data, requestContext) => {
  const user = await db.table('users').get(requestContext.params.userID);
  user.name = data.name;
  user.email = data.email;
  await db.table('users').put(user);
  return {
    user,
  };
}, zod$({
  name: z.string(),
  email: z.string(),
}));

export default component$(() => {
  // `useUserUpdate`é’©å­å°†è¿”å›ä¸€ä¸ªåŒ…å«ä»`routeAction$()`è¿”å›çš„`value`çš„`ActionStore<T>`ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚`submit()`ï¼Œç”¨äºä»¥ç¼–ç¨‹æ–¹å¼æäº¤è¡¨å•ï¼Œå’Œ`isRunning`ã€‚æ‰€æœ‰è¿™äº›å±æ€§éƒ½æ˜¯å“åº”å¼çš„ï¼Œå½“å®ƒä»¬æ›´æ”¹æ—¶ï¼Œå°†é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚
  const userData = useUserUpdate();
  // userData.valueæ˜¯ä»`routeAction$()`è¿”å›çš„å€¼ï¼Œåœ¨æäº¤è¡¨å•ä¹‹å‰ä¸º`undefined`ã€‚
  // userData.formDataæ˜¯æäº¤çš„è¡¨å•æ•°æ®ï¼Œåœ¨æäº¤è¡¨å•ä¹‹å‰ä¸º`undefined`ã€‚
  // userData.isRunningæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå½“è¡¨å•æ­£åœ¨æäº¤æ—¶ä¸ºtrueã€‚
  // userData.submit()æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ç”¨äºä»¥ç¼–ç¨‹æ–¹å¼æäº¤è¡¨å•ã€‚
  // userData.actionPathæ˜¯æ“ä½œçš„è·¯å¾„ï¼Œç”¨äºæäº¤è¡¨å•ã€‚
  return (
    <main>
      <h1>User data</h1>
      <Form action={userData}>
        <div>
          <label>User name: <input name="name" defaultValue={userData.formData?.get('name')} /></label>
        </div>
        <div>
          <label>User email: <input name="email" defaultValue={userData.formData?.get('email')} /></label>
        </div>
        <button type="submit">Update</button>
      </form>
    </main>
  );
});
```

`routeAction$()`ç”¨äºå¤„ç†è¡¨å•æäº¤å’Œå…¶ä»–æ“ä½œçš„ç‰¹æ®Šç»„ä»¶ï¼Œä»…åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒå°†ç”¨æˆ·æ·»åŠ åˆ°æ•°æ®åº“ï¼Œç„¶åé‡å®šå‘åˆ°ç”¨æˆ·é…ç½®æ–‡ä»¶é¡µé¢ã€‚


## Run code only in the browser

Since Qwik executes the same code on the server and in the browser, you cannot use `window` or other browser APIs in your code, because they don't exist when the code is executed on the server.

If you want to access browser APIs, such as `window`, `document`, `localStorage`, `sessionStorage`, `webgl` etc, you need to check if the code is running in the browser before accessing the browser APIs.

```tsx
import { component$, useTask$, useVisibleTask$, useSignal } from '@builder.io/qwik';
import { isBrowser } from '@builder.io/qwik/build';

export default component$(() => {
  const ref = useSignal<Element>();

  // useVisibleTask$ will only run in the browser
  useVisibleTask$(() => {
    // No need to check for `isBrowser` before accessing the DOM, because useVisibleTask$ will only run in the browser
    ref.value?.focus();
    document.title = 'Hello world';
  });

  // useTask might run on the server, so you need to check for `isBrowser` before accessing the DOM
  useTask$(() => {
    if (isBrowser) {
      // This code will only run in the browser only when the component is first rendered there
      ref.value?.focus();
      document.title = 'Hello world';
    }
  });

  return (
    <button
      ref={ref}
      onClick$={() => {
        // All event handlers are only executed in the browser, so it's safe to access the DOM
        ref.value?.focus();
        document.title = 'Hello world';
      }}
    >
      Click me
    </button>
  );
});
```

### `useVisibleTask$(() => { ... })`

æ­¤APIå£°æ˜äº†ä¸€ä¸ªä»…åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„VisibleTaskã€‚å®ƒæ°¸è¿œä¸ä¼šåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚

### JSXäº‹ä»¶å¤„ç†ç¨‹åº

ä»…åœ¨å®¢æˆ·ç«¯ä¸Šæ‰§è¡ŒJSXå¤„ç†ç¨‹åºï¼Œä¾‹å¦‚`onClick$`å’Œ`onInput$`ã€‚è¿™æ˜¯å› ä¸ºå®ƒä»¬æ˜¯DOMäº‹ä»¶ï¼Œç”±äºæœåŠ¡å™¨ä¸Šæ²¡æœ‰DOMï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚

### `isServer`æ¡ä»¶

Qwikæä¾›äº†ä¸€ä¸ªä»`@builder.io/qwik/build`å¯¼å‡ºçš„`isServer`å¸ƒå°”å€¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥ç¡®ä¿ä»£ç ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚

## ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç 

æœ‰æ—¶æ‚¨éœ€è¦ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç ï¼Œä¾‹å¦‚è·å–æ•°æ®æˆ–è®¿é—®æ•°æ®åº“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒQwikæä¾›äº†ä¸€äº›ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç çš„APIã€‚

```tsx
import { component$, useTask$ } from '@builder.io/qwik';
import { server$, routeLoader$ } from '@builder.io/qwik/qwik-city';
import { isServer } from '@builder.io/qwik/build';


export const useGetProducts = routeLoader$((requestEvent) => {
  // æ­¤ä»£ç ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
  const db = await openDB(requestEvent.env.get('DB_PRIVATE_KEY'));
  const product = await db.table('products').select();
  return product;
})

const encryptOnServer = server$(function(message: string) {
  // `this`æ˜¯`requestEvent`
  const secretKey = this.env.get('SECRET_KEY');
  const encryptedMessage = encrypt(message, secretKey);
  return encryptedMessage;
});

export default component$(() => {
  useTask$(() => {
    if (isServer) {
      // æ­¤ä»£ç ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä»…åœ¨ç»„ä»¶é¦–æ¬¡åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“æ—¶è¿è¡Œ
    }
  });

  return (
    <>
      <button
        onClick$={server$(() => {
          // æ­¤ä»£ç ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä»…åœ¨å•å‡»æŒ‰é’®æ—¶è¿è¡Œ
        })}
      >
        Click me
      </button>

      <button
        onClick$={() => {
          // æ­¤ä»£ç å°†è°ƒç”¨æœåŠ¡å™¨å‡½æ•°ï¼Œå¹¶ç­‰å¾…ç»“æœ
          const encrypted = await encryptOnServer('Hello world');
          console.log(encrypted);
        }}
      >
        Click me
      </button>
    </>
  );
});
```

### `routeAction$()`

`routeAction$()`æ˜¯ä»…åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ç‰¹æ®Šç»„ä»¶ã€‚å®ƒç”¨äºå¤„ç†è¡¨å•æäº¤å’Œå…¶ä»–æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒå°†ç”¨æˆ·æ·»åŠ åˆ°æ•°æ®åº“ï¼Œç„¶åé‡å®šå‘åˆ°ç”¨æˆ·é…ç½®æ–‡ä»¶é¡µé¢ã€‚

### `routeLoader$()`

`routeLoader$()`æ˜¯ä»…åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ç‰¹æ®Šç»„ä»¶ã€‚å®ƒç”¨äºè·å–æ•°æ®ï¼Œç„¶åæ¸²æŸ“é¡µé¢ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»APIè·å–æ•°æ®ï¼Œç„¶åä½¿ç”¨æ•°æ®æ¸²æŸ“é¡µé¢ã€‚

### `server$((...args) => { ... })`

`server$()`æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼æ¥å£°æ˜ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å‡½æ•°ã€‚å¦‚æœä»å®¢æˆ·ç«¯è°ƒç”¨å®ƒä»¬ï¼Œå®ƒä»¬å°†åƒRPCè°ƒç”¨ä¸€æ ·åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚å®ƒä»¬å¯ä»¥æ¥å—ä»»ä½•å¯åºåˆ—åŒ–çš„å‚æ•°ï¼Œå¹¶è¿”å›ä»»ä½•å¯åºåˆ—åŒ–çš„å€¼ã€‚

### `isServer`æ¡ä»¶

Qwikæä¾›äº†ä¸€ä¸ªä»`@builder.io/qwik/build`å¯¼å‡ºçš„`isServer`å¸ƒå°”å€¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥ç¡®ä¿ä»£ç ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚
